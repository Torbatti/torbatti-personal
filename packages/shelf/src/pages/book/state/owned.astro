---
import ShelfLayout from "../../_ShelfLayout.astro";

// ! THIS IS NOT A MISTAKE
// ! NO POCKET BASE SERVER IN PROD
import pb from "libs/pocketbase";

const adminData = await pb.admins.authWithPassword('admin@example.com', 'admin@example.com');
const records = await pb.collection('books').getFullList({sort: 'book_title',});
// console.log(records);

const state = "دارا";
---
<ShelfLayout title="کتابخانه" description="" author="" key_words="" child_url="book">

  <div id="posts" class="flex flex-wrap high-gap">
    {records.map((post)=>(
      <>
      {
      (post.book_buy_state !== state) 
      ?<></>
      :
      // <a href=`/book/${post.id}` class="tc5 flex flex-col jcontent-center"></a>
      <div id="post" class="tc2 flex flex-col jcontent-center aitems-center">

        <a href=`/shelf/book/critique/id/${post.id}` class="tc5">{post.book_title}</a>

        <div id="book-from" class="flex low-gap">
          <p> {post.book_author} </p>
          {
            (post.book_translator === "") 
            ?<></>
            :<p>|</p><p> {post.book_translator} </p>
          }
          {
            (post.release_date === "") 
            ?<></>
            :<p>|</p><p> {post.release_date} </p>
          }
        </div>

        <div id="book-state" class="flex low-gap">
          {
            (post.book_buy_state === "") 
            ?<></>
            :<p> {post.book_buy_state} </p>
          }
          {
            (post.book_read_state === "" && post.book_buy_state === "") 
            ?<></>
            :<p>|</p>
          }
          {
            (post.book_read_state === "") 
            ?<></>
            :<p>{post.book_read_state} </p>
          }
          {
            (post.book_read_state === "خوانده") 
            ?<p>|</p> <p>{post.book_rate}</p>
            :<></>
          }
        </div>

        <div id="book-genre">
          {
            (post.book_genre === "") 
            ?<></>
            :<p> {post.book_genre} </p>
          }
        </div>

        <div id="book-series" class="flex low-gap">
          {
            (post.book_series_type === "مجموعه")
            ?
              <p>{post.book_series_type}</p>
              <p>|</p>
              <p>{post.book_series_title}</p>
              <p>|</p>
              <p>C:{post.book_series_chapters}</p>
            : 
              <></>
          }
        </div>

      </div>
      }
      </>
    ))}
  </div>

</ShelfLayout>

<style>
  .shelf{margin-bottom:2rem;}
  .shelf a,.a,#post a{text-decoration:none;font-size:small;font-weight:bold;}
  .shelf a:hover,#post a:hover{text-decoration:underline;}

  #post{font-weight: bold;font-size:small;}
  @media(max-width:768px){
    #items{
      gap:1rem;
    }
    .shelf{
      gap:0.5rem;
    }

    #posts{
      flex-direction:column;
      gap:1rem;
      align-items:start;
    }
    #posts #post{
      align-items:start;
    }
  }


</style>